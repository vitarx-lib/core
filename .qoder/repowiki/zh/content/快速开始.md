# 快速开始

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [packages/vitarx/src/index.ts](file://packages/vitarx/src/index.ts)
- [packages/runtime-core/src/app/App.ts](file://packages/runtime-core/src/app/App.ts)
- [packages/runtime-dom/src/factory.ts](file://packages/runtime-dom/src/factory.ts)
- [packages/responsive/src/index.ts](file://packages/responsive/src/index.ts)
- [packages/runtime-core/src/widget/base/Widget.ts](file://packages/runtime-core/src/widget/base/Widget.ts)
- [packages/runtime-core/src/runtime/hook.ts](file://packages/runtime-core/src/runtime/hook.ts)
</cite>

## 目录
1. [简介](#简介)
2. [安装与配置](#安装与配置)
3. [创建第一个应用](#创建第一个应用)
4. [项目结构概览](#项目结构概览)
5. [核心概念解析](#核心概念解析)
6. [常见问题排查](#常见问题排查)
7. [总结](#总结)

## 简介

Vitarx 是一个现代化的前端框架，它融合了 React 的 JSX 语法与 Vue 的响应式系统，旨在为开发者提供一种简洁、高效且易于上手的开发体验。该框架支持函数式组件和类组件两种模式，并提供了类似于 Vue 的 API 命名方式（如 `ref`、`reactive`、`watch`、`computed` 等），大幅降低了学习成本。

通过 JSX 语法，开发者可以更直观地编写 UI 结构；而响应式数据机制则确保当数据变化时视图能够自动更新。此外，Vitarx 还具备组件化、生命周期管理、虚拟 DOM 和高效的 Diff 算法等现代前端框架的核心特性。

本指南将帮助零基础开发者在 5 分钟内完成环境搭建并运行第一个 Vitarx 应用。

**Section sources**
- [README.md](file://README.md#L8-L23)

## 安装与配置

你可以使用 npm、yarn 或 pnpm 来安装 Vitarx 框架。推荐使用 pnpm，因为它在性能和磁盘空间利用方面表现更优。

### 使用 npm 安装
```bash
npm install vitarx
```

### 使用 yarn 安装
```bash
yarn add vitarx
```

### 使用 pnpm 安装
```bash
pnpm add vitarx
```

### JSX 配置要求

由于 Vitarx 使用 JSX 语法，你需要在项目中正确配置 JSX 支持：

- **TypeScript 项目**：在 `tsconfig.json` 中添加：
  ```json
  {
    "compilerOptions": {
      "jsx": "react-jsx",
      "jsxImportSource": "vitarx"
    }
  }
  ```

- **Babel 项目**：在 `.babelrc` 或 `babel.config.js` 中配置：
  ```json
  {
    "plugins": [
      ["@babel/plugin-transform-react-jsx", {
        "runtime": "automatic",
        "importSource": "vitarx"
      }]
    ]
  }
  ```

- **Vite 项目**：在 `vite.config.ts` 中无需额外配置，Vite 默认支持 JSX。

完成安装后，即可在项目中导入 Vitarx 并开始使用。

**Section sources**
- [packages/vitarx/src/index.ts](file://packages/vitarx/src/index.ts#L1-L7)
- [packages/vitarx/src/jsx-runtime.ts](file://packages/vitarx/src/jsx-runtime.ts#L1-L30)

## 创建第一个应用

创建 Vitarx 应用的核心是使用 `createApp` 函数来创建应用实例，并将其挂载到 DOM 元素上。

### 步骤 1：创建根组件

你可以使用函数式组件或类组件作为根组件。以下是一个简单的函数式组件示例：

```tsx
import { ref } from 'vitarx'

function App() {
  const count = ref(0)
  const add = () => {
    count.value++
  }

  return (
    <div>
      <h1>count: {count.value}</h1>
      <button onClick={add}>add</button>
    </div>
  )
}
```

### 步骤 2：创建并挂载应用实例

使用 `createApp` 创建应用实例，并调用 `.mount()` 方法将其挂载到指定的 DOM 容器：

```tsx
import { createApp } from 'vitarx'
import App from './App'

createApp(App).mount('#app')
```

### `createApp` 函数详解

`createApp` 是一个工厂函数，定义于 `@vitarx/runtime-dom` 包中，用于创建 `App` 实例。其签名如下：

```ts
function createApp(root: VNode | WidgetTypes, config?: AppConfig): App
```

- `root`：应用的根节点，可以是虚拟节点（VNode）或组件类型（函数或类）。
- `config`：可选的应用配置对象，包含错误处理器、ID 前缀等。

该函数内部会自动设置 DOM 渲染器并返回一个 `App` 实例，支持链式调用。

### `App` 类核心方法

`App` 类是应用的主控制器，主要方法包括：

- `mount(container)`：将应用挂载到指定容器（DOM 元素或选择器字符串）。
- `unmount()`：卸载应用，清理资源。
- `use(plugin)`：注册插件。
- `directive(name, directive)`：注册全局指令。
- `provide(name, value)`：提供依赖注入数据。

**Section sources**
- [packages/runtime-dom/src/factory.ts](file://packages/runtime-dom/src/factory.ts#L21-L23)
- [packages/runtime-core/src/app/App.ts](file://packages/runtime-core/src/app/App.ts#L107-L202)

## 项目结构概览

典型的 Vitarx 项目结构如下：

```
src/
├── components/
│   └── MyComponent.tsx
├── App.tsx
└── main.tsx
```

### 入口文件 `main.tsx`

```tsx
import { createApp } from 'vitarx'
import App from './App'

createApp(App).mount('#app')
```

### 根组件 `App.tsx`

```tsx
import { ref } from 'vitarx'

export default function App() {
  const message = ref('Hello Vitarx')
  return <h1>{message.value}</h1>
}
```

### HTML 容器

确保 HTML 文件中存在对应的挂载点：

```html
<!DOCTYPE html>
<html>
<head><title>Vitarx App</title></head>
<body>
  <div id="app"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>
</html>
```

**Section sources**
- [README.md](file://README.md#L28-L84)

## 核心概念解析

### 响应式系统

Vitarx 的响应式系统位于 `@vitarx/responsive` 包中，提供了 `ref`、`reactive`、`computed`、`watch` 等 API，其行为与 Vue 高度一致。

```ts
import { ref, reactive, computed, watch } from 'vitarx'

const count = ref(0)
const state = reactive({ name: 'Vitarx' })
const doubled = computed(() => count.value * 2)

watch(() => count.value, (newVal) => {
  console.log('count changed:', newVal)
})
```

**Section sources**
- [packages/responsive/src/index.ts](file://packages/responsive/src/index.ts#L1-L5)

### 组件类型

Vitarx 支持两种组件类型：

#### 函数式组件

使用函数定义组件，内部可通过 `ref`、`onMounted` 等组合式 API 构建逻辑。

```tsx
function MyWidget() {
  onMounted(() => console.log('mounted'))
  return <div>Function Component</div>
}
```

#### 类组件

继承自 `Widget` 基类，支持生命周期钩子和属性定义。

```tsx
class MyWidget extends Widget {
  onMounted() {
    console.log('mounted')
  }
  build() {
    return <div>Class Component</div>
  }
}
```

`Widget` 类提供了丰富的生命周期钩子，如 `onCreate`、`onMounted`、`onUpdated`、`onUnmounted` 等。

**Section sources**
- [packages/runtime-core/src/widget/base/Widget.ts](file://packages/runtime-core/src/widget/base/Widget.ts#L45-L387)
- [packages/runtime-core/src/runtime/hook.ts](file://packages/runtime-core/src/runtime/hook.ts#L144-L217)

### 生命周期钩子

Vitarx 提供了完整的生命周期支持，常用钩子包括：

| 钩子 | 触发时机 |
|------|--------|
| `onCreate` | 组件实例创建时 |
| `onBeforeMount` | 挂载前 |
| `onMounted` | 挂载完成后 |
| `onBeforeUpdate` | 更新前 |
| `onUpdated` | 更新完成后 |
| `onBeforeUnmount` | 卸载前 |
| `onUnmounted` | 卸载完成后 |

这些钩子可在函数式组件中直接调用注册。

## 常见问题排查

### 1. JSX 语法报错

**问题**：出现 `JSX not defined` 或类型错误。

**解决方案**：
- 确保已正确配置 `jsxImportSource`。
- 检查 `tsconfig.json` 或 Babel 配置是否启用 JSX。
- 确保文件扩展名为 `.tsx`。

### 2. 类型错误：`Property 'xxx' does not exist on type 'JSX.IntrinsicElements'`

**问题**：TS 报错无法识别 HTML 标签。

**解决方案**：
在项目中创建 `vitarx.d.ts` 文件，扩展 JSX 命名空间：

```ts
declare namespace JSX {
  interface IntrinsicElements {
    [elemName: string]: any
  }
}
```

### 3. `createApp is not a function`

**问题**：导入失败。

**解决方案**：
确保正确导入：
```ts
import { createApp } from 'vitarx'
```
不要使用默认导入。

### 4. 挂载失败：元素未找到

**问题**：调用 `app.mount('#app')` 报错“元素未找到”。

**解决方案**：
- 确保 DOM 元素在脚本执行前已存在。
- 使用 `window.onload` 或 `DOMContentLoaded` 确保 DOM 加载完成后再挂载。

```ts
window.addEventListener('DOMContentLoaded', () => {
  createApp(App).mount('#app')
})
```

## 总结

Vitarx 是一个融合 React JSX 语法与 Vue 响应式系统的现代化前端框架，具有简洁的 API 设计和强大的功能支持。通过本快速入门指南，你已经学会了如何：

- 安装 Vitarx 并配置 JSX
- 使用 `createApp` 创建应用实例
- 编写函数式或类组件
- 挂载应用到 DOM
- 处理常见配置问题

现在你可以基于此基础构建更复杂的应用。建议参考官方文档深入了解响应式系统、组件通信、状态管理等高级特性。

**Section sources**
- [README.md](file://README.md#L8-L84)
- [packages/vitarx/src/index.ts](file://packages/vitarx/src/index.ts#L1-L7)
- [packages/runtime-core/src/app/App.ts](file://packages/runtime-core/src/app/App.ts#L107-L202)